
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Autonomous Object Retrieval Robot</title>

    <!-- Bootstrap core CSS -->
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!-- <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet"> -->

    <!-- Custom styles for this template -->
    <link href="starter-template.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!-- <script src="../../assets/js/ie-emulation-modes-warning.js"></script> -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Autonomous Object Retrieval Robot</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#intro">Introduction</a></li>
            <li><a href="#obj">Project Objective</a></li>
            <li><a href="#design">Design</a></li>
            <li><a href="#drawings">Drawings</a></li>
            <li><a href="#testing">Testing</a></li>
            <li><a href="#result">Result</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">

      <div class="starter-template">
        <h1>Autonomous Object Retrieval Robot</h1>
        <p class="lead">Innovative and Impressive<br>A Project By Chenxin Xun and Pengru Lung.</p>
      </div>

      <hr>
      <div class="center-block">
          <iframe width="640" height="360" src="https://www.youtube.com/embed?v=et91Gea6CPk" frameborder="0" allowfullscreen></iframe>
          <h4 style="text-align:center;">Demonstration Video</h4>
      </div>

      <hr id="intro">

      <div style="text-align:center;">
              <h2>Introduction</h2>
              <p style="text-align: left;padding: 0px 30px;">This project aims to design and build an autonomous object retrieval robot capable of identifying and retrieving objects based on their color. The system utilizes a pair of Raspberry Pi devices, both equipped with cameras, and a robot with an arm featuring servos for object picking. The robot interacts with the user by receiving a color signal through a glove equipped with a camera, searching for the corresponding object, picking it up, and delivering it to the user.</p>
      </div>

    <hr id='obj'>

      <div class="row">
          <div class="col-md-4" style="text-align:center;">
          <img class="img-rounded" src="pics/1.jpg" alt="Generic placeholder image" width="240" height="240">
          </div>
          <div class="col-md-8" style="font-size:18px;">
          <h2>Project Objective:</h2>
          <ul>
            <li>Design an autonomous robot capable of identifying objects based on their color.</li>
            <li>Implement a robotic arm with servos for precise object picking and placement.</li>
            <li>Utilize two Raspberry Pi devices, both equipped with cameras, for message transmission and system control.</li>
            <li>Enable user interaction via a camera-equipped glove to specify the desired object color.</li>
            <li>Ensure smooth and reliable object detection, retrieval, and delivery to the user.</li>
          </ul>
          </div>
      </div>

    <hr id='design'>

      <div style="text-align:center;">
              <h2>Design</h2>
              <h3 style="text-align: center; padding: 0px 150px;">Hardware Design</h3>
              <h4 style="text-align: center; padding: 0px 150px;">Glove Design</h4>
              <p style="text-align: justify; padding: 0px 150px;">We have mounted the Raspberry Pi 4 and a camera onto the glove. Also, we implemented a button on the Raspberry Pi 4 to control the camera. Using soldering, we connected the button and a 1kΩ resistor, wiring them to GPIO pin 17 and Ground. This setup was thoroughly tested to ensure both the hardware’s stability and the responsiveness of the button control.</p>
              <h4 style="text-align: center; padding: 0px 150px;">Robot Design</h4>
              <p style="text-align: justify; padding: 0px 150px;">In our robot design, we utilize a Raspberry Pi 4 to control the robot's movements and arm. The robot is equipped with two servos for controlling the arm and two servos for robot movement. The servos are connected to specific GPIO pins on the Raspberry Pi, which are used to send control signals for precise movement. The Raspberry Pi acts as the central control unit, coordinating the servos' actions based on the input from the camera-equipped glove. Our GPIO pin mappings are shown in the table below.</p> 
              <h4 style="text-align: center; padding: 0px 150px;">Table 1: RaspberryPi GPIO Pin to Signal Mapping</h4>
              <table style="width: 100%; text-align: center; padding: 0px 150px; border-collapse: collapse;">
                <tr>
                  <th style="border-bottom: 1px solid #D3D3D3; padding: 8px; text-align: center;">Pi GPIO Pin</th>
                  <th style="border-bottom: 1px solid #D3D3D3; padding: 8px; text-align: center;">Signal Name</th>
                  <tr>
                    <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">GPIO 4</td>
                    <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;"></td>
                  </tr>
                  <tr>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">GPIO 5</td>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;"></td>
                </tr>
                <tr>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">GPIO 6</td>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;"></td>
                </tr>
                <tr>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">GPIO 12</td>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;"></td>
                </tr>
                <tr>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">GPIO 13</td>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;"></td>
                </tr>
                <tr>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">GPIO 16</td>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">PWM signal for right motor</td>
                </tr>
                <tr>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">GPIO 19</td>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">PWM signal for left motor</td>
                </tr>
                <tr>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">GPIO 20</td>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;"></td>
                </tr>
                <tr>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">GPIO 21</td>
                  <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;"></td>
                  <tr>
                    <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">GPIO 23</td>
                    <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;"></td>
                  </tr>
                  <tr>
                    <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;">GPIO 26</td>
                    <td style="border-bottom: 1px solid #D3D3D3; padding: 8px;"></td>
              </table>   
              <h3 style="text-align: center; padding: 0px 150px;">Software Design</h3>
              <h4 style="text-align: center; padding: 0px 150px;">Glove Design</h4>
              <p style="text-align: justify; padding: 0px 150px;">The software design for the device is centered around detecting and identifying color-coded objects using computer vision techniques and sending the detected color to the robot. The program utilizes the OpenCV library (cv2) for real-time image processing, where the camera feed is continuously captured and analyzed to detect specific color cubes.</p>
              <p style="text-align: justify; padding: 0px 150px;">1. The Color Detection: The color detection is based on the HSV color space, with predefined ranges for different colors (Green, Blue, Yellow). The software first captures a frame from the camera, converts it to the HSV color space, and then applies a mask to isolate regions of the image matching the color ranges. Contours of these regions are found and used to calculate the center of the object.</p>
              <p style="text-align: justify; padding: 0px 150px;">2. System Integration: A button is used to trigger the color detection process, allowing the user to initiate the system when desired. Once the color is detected, the software sends the color information via a socket connection to a remote server, ensuring the robot is informed of the object’s color for further action.</p>
              <h4 style="text-align: center; padding: 0px 150px;">Robot Design</h4>
              <p style="text-align: justify; padding: 0px 150px;">1. Server: The robot's communication system uses a server-side setup to receive color data transmitted from the camera-equipped glove. A socket server listens for incoming connections and is configured to bind to a specific IP address and port. Once a connection is established, the server waits for color data sent by the client (the glove's camera system). This data is then received, decoded, and processed to trigger robot actions based on the specified color. </p> 
              <p style="text-align: justify; padding: 0px 150px;">2. Arm control</p>
              <p style="text-align: justify; padding: 0px 150px;">3. Motor control</p>
              <p style="text-align: justify; padding: 0px 150px;">2. Integration</p>

      </div>

    <hr id='drawings'>

      <div style="text-align:center;">
              <h2>Drawings</h2>
              <p style="text-align: left;padding: 0px 30px;">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum lorem nulla, consectetur at leo vel, pretium bibendum nisl. Cras blandit quam a enim ultrices, eu convallis enim posuere. Donec eleifend enim sed purus consectetur, vitae cursus lectus varius. Vivamus consectetur felis nec est venenatis posuere. Phasellus vitae aliquet erat. In laoreet lacinia mollis. Quisque iaculis nisl fermentum pharetra lobortis. Donec rhoncus dui sem, ac molestie leo tristique vel. Phasellus in nibh feugiat, fringilla lectus in, elementum magna. Etiam quis dui condimentum, tempus ex in, dapibus est. Cras ut congue augue. Donec ac enim ex. Ut id tristique risus, vel porttitor quam. Sed ultricies enim eu nibh porttitor, vel sodales enim feugiat. Fusce volutpat venenatis magna ac ultrices. Curabitur eget urna ut nulla mattis convallis non eu diam.</p>
      </div>

    <hr id='testing'>

      <div style="text-align:center;">
              <h2>Testing</h2>
              <p style="text-align: left;padding: 0px 30px;">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum lorem nulla, consectetur at leo vel, pretium bibendum nisl. Cras blandit quam a enim ultrices, eu convallis enim posuere. Donec eleifend enim sed purus consectetur, vitae cursus lectus varius. Vivamus consectetur felis nec est venenatis posuere. Phasellus vitae aliquet erat. In laoreet lacinia mollis. Quisque iaculis nisl fermentum pharetra lobortis. Donec rhoncus dui sem, ac molestie leo tristique vel. Phasellus in nibh feugiat, fringilla lectus in, elementum magna. Etiam quis dui condimentum, tempus ex in, dapibus est. Cras ut congue augue. Donec ac enim ex. Ut id tristique risus, vel porttitor quam. Sed ultricies enim eu nibh porttitor, vel sodales enim feugiat. Fusce volutpat venenatis magna ac ultrices. Curabitur eget urna ut nulla mattis convallis non eu diam.</p>
      </div>

    <hr id='result'>

      <div style="text-align:center;">
              <h2>Result</h2>
              <p style="text-align: left;padding: 0px 30px;">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum lorem nulla, consectetur at leo vel, pretium bibendum nisl. Cras blandit quam a enim ultrices, eu convallis enim posuere. Donec eleifend enim sed purus consectetur, vitae cursus lectus varius. Vivamus consectetur felis nec est venenatis posuere. Phasellus vitae aliquet erat. In laoreet lacinia mollis. Quisque iaculis nisl fermentum pharetra lobortis. Donec rhoncus dui sem, ac molestie leo tristique vel. Phasellus in nibh feugiat, fringilla lectus in, elementum magna. Etiam quis dui condimentum, tempus ex in, dapibus est. Cras ut congue augue. Donec ac enim ex. Ut id tristique risus, vel porttitor quam. Sed ultricies enim eu nibh porttitor, vel sodales enim feugiat. Fusce volutpat venenatis magna ac ultrices. Curabitur eget urna ut nulla mattis convallis non eu diam.</p>
      </div>

    <hr>

    <div class="row" style="text-align:center;">
          <h2>Work Distribution</h2>
          <div style="text-align:center;">
              <img class="img-rounded" src="pics/group.jpg" alt="Generic placeholder image" style="width:80%;">
              <h4>Project group picture</h4>
          </div>
          <div class="col-md-6" style="font-size:16px">
              <img class="img-rounded" src="pics/a.png" alt="Generic placeholder image" width="240" height="240">
              <h3>Chenxin Xun</h3>
              <p class="lead">cx258@cornell.edu</p>
              <p>Robot Movement and Object Retrieval Design
          </div>
          <div class="col-md-6" style="font-size:16px">
              <img class="img-rounded" src="pics/b.png" alt="Generic placeholder image" width="240" height="240">
              <h3>Peng-Ru Lung</h3>
              <p class="lead">pl649@cornell.edu</p>
              <p>Design of Camera-Equipped Glove and Transmission System 
          </div>
      </div>

    <hr>
      <div style="font-size:18px">
          <h2>Parts List</h2>
          <ul>
              <li>Raspberry Pi 4 $35.00</li>
              <li>Raspberry Pi Camera V2 $20.00</li>
              <li>Raspberry Pi Camera V2 $20.00</li>
              <a href="https://www.amazon.com/dp/B081YH77C3?ref=ppx%20yo2ov%20dt%20b%20fed%20asin%20title"><li>Robot Arm - $22.13</li></a>
              <li>Resistors, Wires and Buttons- Provided in lab</li>
          </ul>
          <h3>Total: $97.13</h3>
      </div>
      <hr>
      <div style="font-size:18px">
          <h2>References</h2>
          <a href="https://picamera.readthedocs.io/">PiCamera Document</a><br>
          <a href="http://www.micropik.com/PDF/SG90Servo.pdf">Tower Pro Servo Datasheet</a><br>
          <a href="http://abyz.co.uk/rpi/pigpio/">Pigpio Library</a><br>
          <a href="https://sourceforge.net/p/raspberry-gpio-python/wiki/Home/">R-Pi GPIO Document</a><br>
          <a href="https://projects.raspberrypi.org/en/projects/get-started-pico-w/3">Open a Socket</a><br>

      </div>

    <hr>

      <div class="row">
              <h2>Code Appendix</h2>
              <pre><code>
// Hello World.c
int main(){
  printf("Hello World.\n");
}
              </code></pre>
              <pre><code>
//Server_color.py
<span style="color: #0e84b5; font-weight: bold">import socket</span>
<span style="color: #888888"># Function to handle receiving color data from a client</span>
<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">sending_color</span>():
  <span style="color: #008800; font-weight: bold">global</span> data
  <span style="color: #888888"># Server configuration</span>
  HOST <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;10.49.240.92&#39;</span> <span style="color: #888888"># Server&#39;s IP address</span>
  PORT <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">5000</span>      <span style="color: #888888"># Port to listen on</span>

  <span style="color: #888888"># Create a socket</span>
  server_socket <span style="color: #333333">=</span> socket<span style="color: #333333">.</span>socket(socket<span style="color: #333333">.</span>AF_INET, socket<span style="color: #333333">.</span>SOCK_STREAM)
  <span style="color: #888888"># Allow address reuse</span>
  server_socket<span style="color: #333333">.</span>setsockopt(socket<span style="color: #333333">.</span>SOL_SOCKET, socket<span style="color: #333333">.</span>SO_REUSEADDR, <span style="color: #0000DD; font-weight: bold">1</span>)  
  <span style="color: #888888"># Bind the socket to the specified IP and port</span>
  server_socket<span style="color: #333333">.</span>bind((HOST, PORT)) 
  <span style="color: #888888"># Listen for incoming connections (1 client at a time)</span>
  server_socket<span style="color: #333333">.</span>listen(<span style="color: #0000DD; font-weight: bold">1</span>) 

  <span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&quot;Server is waiting for a connection...&quot;</span>)

  <span style="color: #888888"># Accept a connection</span>
  client_socket, client_address <span style="color: #333333">=</span> server_socket<span style="color: #333333">.</span>accept()
  <span style="color: #008800; font-weight: bold">print</span>(f<span style="background-color: #fff0f0">&quot;Connected by {client_address}&quot;</span>)

  <span style="color: #888888"># Receive data</span>
  data <span style="color: #333333">=</span> client_socket<span style="color: #333333">.</span>recv(<span style="color: #0000DD; font-weight: bold">1024</span>)<span style="color: #333333">.</span>decode(<span style="background-color: #fff0f0">&#39;utf-8&#39;</span>)
  <span style="color: #008800; font-weight: bold">print</span>(f<span style="background-color: #fff0f0">&quot;Received: {data}&quot;</span>)

  <span style="color: #888888"># Close the client and server sockets to clean up resources</span>
  client_socket<span style="color: #333333">.</span>close()
  server_socket<span style="color: #333333">.</span>close()
          </code></pre>
          <pre><code>
  //color_detect_send.py
  <span style="color: #0e84b5; font-weight: bold">import socket</span> <span style="color: #888888"># For video capture and image processing</span>
  <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">numpy</span> <span style="color: #008800; font-weight: bold">as</span> <span style="color: #0e84b5; font-weight: bold">np</span>
  <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">threading</span>
  <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">socket</span>
  <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">time</span>
  <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">RPi._GPIO</span> <span style="color: #008800; font-weight: bold">as</span> <span style="color: #0e84b5; font-weight: bold">GPIO</span> <span style="color: #888888"># For Raspberry Pi GPIO control</span>
  <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">os</span>
  <span style="color: #888888"># Configure GPIO settings</span>
  GPIO<span style="color: #333333">.</span>setmode(GPIO<span style="color: #333333">.</span>BCM)
  GPIO<span style="color: #333333">.</span>setup(<span style="color: #0000DD; font-weight: bold">17</span>, GPIO<span style="color: #333333">.</span>IN, pull_up_down<span style="color: #333333">=</span>GPIO<span style="color: #333333">.</span>PUD_UP)
  
  stop <span style="color: #333333">=</span> <span style="color: #007020">False</span> 
  cap <span style="color: #333333">=</span> <span style="color: #007020">None</span>
  lock <span style="color: #333333">=</span> threading<span style="color: #333333">.</span>Lock()
  color_name <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;&#39;</span>
  
  <span style="color: #888888"># Server connection IP address and port number</span>
  HOST <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&#39;10.49.240.92&#39;</span>
  PORT <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">5000</span>        
  
  <span style="color: #888888"># Define HSV color ranges for different colors</span>
  color_ranges <span style="color: #333333">=</span> {
      <span style="background-color: #fff0f0">&quot;Green&quot;</span>: ([<span style="color: #0000DD; font-weight: bold">45</span>, <span style="color: #0000DD; font-weight: bold">35</span>, <span style="color: #0000DD; font-weight: bold">35</span>], [<span style="color: #0000DD; font-weight: bold">75</span>, <span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>]),    
      <span style="background-color: #fff0f0">&quot;Blue&quot;</span>: ([<span style="color: #0000DD; font-weight: bold">105</span>, <span style="color: #0000DD; font-weight: bold">125</span>, <span style="color: #0000DD; font-weight: bold">125</span>], [<span style="color: #0000DD; font-weight: bold">135</span>, <span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>]),  
      <span style="background-color: #fff0f0">&quot;Yellow&quot;</span>: ([<span style="color: #0000DD; font-weight: bold">20</span>, <span style="color: #0000DD; font-weight: bold">180</span>, <span style="color: #0000DD; font-weight: bold">180</span>], [<span style="color: #0000DD; font-weight: bold">40</span>, <span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>]), 
  }
  
  <span style="color: #888888"># Function to identify the main color in a frame</span>
  <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">find_main_color</span>(frame):
      <span style="color: #888888"># Convert the frame to HSV color space</span>
      hsv_frame <span style="color: #333333">=</span> cv2<span style="color: #333333">.</span>cvtColor(frame, cv2<span style="color: #333333">.</span>COLOR_BGR2HSV)
  
      <span style="color: #888888"># Initialize to store color count</span>
      color_count <span style="color: #333333">=</span> {color: <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #008800; font-weight: bold">for</span> color <span style="color: #000000; font-weight: bold">in</span> color_ranges}
      <span style="color: #888888"># Loop through each color range and apply a mask</span>
      <span style="color: #008800; font-weight: bold">for</span> color_name, (lower, upper) <span style="color: #000000; font-weight: bold">in</span> color_ranges<span style="color: #333333">.</span>items():
          <span style="color: #888888"># Create lower and upper bound arrays</span>
          lower_bound <span style="color: #333333">=</span> np<span style="color: #333333">.</span>array(lower, dtype<span style="color: #333333">=</span>np<span style="color: #333333">.</span>uint8)
          upper_bound <span style="color: #333333">=</span> np<span style="color: #333333">.</span>array(upper, dtype<span style="color: #333333">=</span>np<span style="color: #333333">.</span>uint8)
  
          <span style="color: #888888"># Create a binary mask where color is detected</span>
          mask <span style="color: #333333">=</span> cv2<span style="color: #333333">.</span>inRange(hsv_frame, lower_bound, upper_bound)
  
          <span style="color: #888888"># Count the number of pixels matching the color</span>
          color_count[color_name] <span style="color: #333333">=</span> np<span style="color: #333333">.</span>sum(mask)  <span style="color: #888888"># Sum the pixels that match the color</span>
  
      <span style="color: #888888"># Determine the main color (the one with the highest count)</span>
      main_color <span style="color: #333333">=</span> <span style="color: #007020">max</span>(color_count, key<span style="color: #333333">=</span>color_count<span style="color: #333333">.</span>get)
      <span style="color: #888888"># Ignore insignificant detections</span>
      <span style="color: #008800; font-weight: bold">if</span> color_count[main_color] <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">300</span>:
          <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">None</span>
      <span style="color: #008800; font-weight: bold">print</span>(f<span style="background-color: #fff0f0">&quot;The main color detected is: {main_color}&quot;</span>)
      <span style="color: #008800; font-weight: bold">return</span> main_color
  
  <span style="color: #888888"># Function to send the detected color to a server</span>
  <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">send_color</span>(message):
      <span style="color: #888888"># Create a client socket </span>
      client_socket <span style="color: #333333">=</span> socket<span style="color: #333333">.</span>socket(socket<span style="color: #333333">.</span>AF_INET, socket<span style="color: #333333">.</span>SOCK_STREAM)
      <span style="color: #008800; font-weight: bold">while</span> <span style="color: #007020">True</span>:
          <span style="color: #008800; font-weight: bold">try</span>:
              <span style="color: #888888"># Try to connect to the server</span>
              client_socket<span style="color: #333333">.</span>connect((HOST, PORT))
              <span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&quot;Connected to the server successfully.&quot;</span>)
              <span style="color: #008800; font-weight: bold">break</span>  <span style="color: #888888"># Exit the loop once connected</span>
          <span style="color: #008800; font-weight: bold">except</span> socket<span style="color: #333333">.</span>error <span style="color: #008800; font-weight: bold">as</span> e:
              <span style="color: #008800; font-weight: bold">print</span>(f<span style="background-color: #fff0f0">&quot;Connection failed: {e}. Retrying in 5 seconds...&quot;</span>)
              time<span style="color: #333333">.</span>sleep(<span style="color: #0000DD; font-weight: bold">5</span>)  <span style="color: #888888"># Wait for 5 seconds before retrying</span>
  
      <span style="color: #888888"># Send the encoded message to the server</span>
      client_socket<span style="color: #333333">.</span>send(message<span style="color: #333333">.</span>encode(<span style="background-color: #fff0f0">&#39;utf-8&#39;</span>))
      time<span style="color: #333333">.</span>sleep(<span style="color: #0000DD; font-weight: bold">3</span>) 
  
      <span style="color: #888888"># Close the connection</span>
      client_socket<span style="color: #333333">.</span>close()
      <span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&quot;Connection closed.&quot;</span>)
  
  <span style="color: #888888"># Function to handle color detection    </span>
  <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">color_detection</span>():
      <span style="color: #008800; font-weight: bold">global</span> stop, cap, color_name
      cap <span style="color: #333333">=</span> cv2<span style="color: #333333">.</span>VideoCapture(<span style="color: #0000DD; font-weight: bold">0</span>)  <span style="color: #888888"># Open the default camera</span>
      
      <span style="color: #008800; font-weight: bold">while</span> <span style="color: #007020">True</span>:
          ret, frame <span style="color: #333333">=</span> cap<span style="color: #333333">.</span>read() <span style="color: #888888"># Capture a frame</span>
          <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> ret:
              cd_stop() <span style="color: #888888"># Stop if no frame is captured</span>
              <span style="color: #008800; font-weight: bold">break</span>
  
          <span style="color: #888888"># Process the frame to find color cubes</span>
          <span style="color: #008800; font-weight: bold">with</span> lock:
              color_name <span style="color: #333333">=</span> find_main_color(frame) <span style="color: #888888"># Detect main color</span>
          <span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&quot;color_detection:::::::::::::::::::&quot;</span>, color_name)  
          time<span style="color: #333333">.</span>sleep(<span style="color: #6600EE; font-weight: bold">0.5</span>)  
          <span style="color: #888888"># If a recognized color is detected, send it to the server</span>
          <span style="color: #008800; font-weight: bold">if</span> (color_name<span style="color: #333333">==</span><span style="background-color: #fff0f0">&quot;Green&quot;</span> <span style="color: #000000; font-weight: bold">or</span> color_name<span style="color: #333333">==</span><span style="background-color: #fff0f0">&quot;Yellow&quot;</span> <span style="color: #000000; font-weight: bold">or</span> color_name<span style="color: #333333">==</span><span style="background-color: #fff0f0">&quot;Blue&quot;</span>):
              message <span style="color: #333333">=</span> f<span style="background-color: #fff0f0">&quot;{color_name}&quot;</span>
              cd_stop()
              send_color(message)
  
          <span style="color: #888888"># Exit the loop if &#39;q&#39; is pressed</span>
          <span style="color: #008800; font-weight: bold">if</span> cv2<span style="color: #333333">.</span>waitKey(<span style="color: #0000DD; font-weight: bold">1</span>) <span style="color: #333333">&amp;</span> <span style="color: #005588; font-weight: bold">0xFF</span> <span style="color: #333333">==</span> <span style="color: #007020">ord</span>(<span style="background-color: #fff0f0">&#39;q&#39;</span>):
              stop <span style="color: #333333">=</span> <span style="color: #007020">True</span>
              cd_stop()
              <span style="color: #008800; font-weight: bold">break</span>
  <span style="color: #888888"># Function to clean up video capture resources</span>
  <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">cd_stop</span>():
      <span style="color: #008800; font-weight: bold">global</span> cap
      cap<span style="color: #333333">.</span>release() <span style="color: #888888"># Release the camera</span>
      cv2<span style="color: #333333">.</span>destroyAllWindows() <span style="color: #888888"># Close all OpenCV windows</span>
  
  <span style="color: #008800; font-weight: bold">try</span>:
      <span style="color: #008800; font-weight: bold">while</span>(<span style="color: #007020">True</span>):
          flag17 <span style="color: #333333">=</span> GPIO<span style="color: #333333">.</span>input(<span style="color: #0000DD; font-weight: bold">17</span>) <span style="color: #888888"># Monitor GPIO pin 17 for input</span>
          <span style="color: #008800; font-weight: bold">while</span>(flag17): 
              time<span style="color: #333333">.</span>sleep(<span style="color: #6600EE; font-weight: bold">0.1</span>)  
              flag17 <span style="color: #333333">=</span> GPIO<span style="color: #333333">.</span>input(<span style="color: #0000DD; font-weight: bold">17</span>)
              <span style="color: #008800; font-weight: bold">if</span> flag17<span style="color: #333333">==</span><span style="color: #0000DD; font-weight: bold">0</span>: <span style="color: #888888"># Start color detection when flag17 is low</span>
                  color_detection()
  <span style="color: #008800; font-weight: bold">except</span> <span style="color: #FF0000; font-weight: bold">KeyboardInterrupt</span>:
      <span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&quot;Keyboard interrupt received. Cleaning up...&quot;</span>)
  <span style="color: #008800; font-weight: bold">finally</span>:
      GPIO<span style="color: #333333">.</span>cleanup() <span style="color: #888888"># Reset GPIO pins</span>
      cd_stop()  <span style="color: #888888"># Release camera and clean up resources</span>
                </code></pre>
      </div>

    </div><!-- /.container -->




    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!-- <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script> -->
  </body>
</html>
